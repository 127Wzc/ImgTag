# ImgTag - æ™ºèƒ½å›¾ç‰‡æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ

åŸºäº AI è§†è§‰æ¨¡å‹çš„å›¾ç‰‡æ ‡ç­¾è‡ªåŠ¨ç”Ÿæˆä¸å‘é‡æœç´¢ç³»ç»Ÿã€‚

![License](https://img.shields.io/badge/License-MIT-blue.svg)
![Python](https://img.shields.io/badge/Python-3.10+-green.svg)
![Vue](https://img.shields.io/badge/Vue-3-brightgreen.svg)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– AI æ™ºèƒ½æ ‡ç­¾
- æ”¯æŒ OpenAIã€é€šä¹‰åƒé—®ã€Gemini ç­‰è§†è§‰æ¨¡å‹
- è‡ªåŠ¨åˆ†æå›¾ç‰‡ç”Ÿæˆæè¿°å’Œæ ‡ç­¾
- å¯è‡ªå®šä¹‰åˆ†ææç¤ºè¯
- **æ ‡ç­¾æ¥æºè¿½è¸ª**ï¼šåŒºåˆ† AI ç”Ÿæˆå’Œç”¨æˆ·æ‰‹åŠ¨æ·»åŠ çš„æ ‡ç­¾

### ğŸ” è¯­ä¹‰å‘é‡æœç´¢
- åŸºäºæ–‡æœ¬æè¿°çš„ç›¸ä¼¼å›¾ç‰‡æ£€ç´¢
- æ··åˆæœç´¢ï¼šå‘é‡ç›¸ä¼¼åº¦ + æ ‡ç­¾æƒé‡
- æ”¯æŒåŠ¨æ€è°ƒæ•´æƒé‡

### ğŸ“ æ”¶è—å¤¹ç®¡ç†
- å±‚çº§æ”¶è—å¤¹ï¼ˆæ”¯æŒçˆ¶å­å…³ç³»ï¼‰
- æ·»åŠ åˆ°æ”¶è—å¤¹è‡ªåŠ¨è¿½åŠ æ ‡ç­¾
- éšæœºå›¾ç‰‡ APIï¼ˆæ”¯æŒæ ‡ç­¾ç­›é€‰ï¼‰

### ğŸ·ï¸ æ ‡ç­¾ç³»ç»Ÿ
- **è§„èŒƒåŒ–å…³è”è¡¨è®¾è®¡**ï¼šæ ‡ç­¾å­˜å‚¨äºç‹¬ç«‹å…³è”è¡¨
- æ ‡ç­¾æ¥æºåŒºåˆ†ï¼ˆAI/ç”¨æˆ·ï¼‰
- æ ‡ç­¾å»ºè®®ä¸æœç´¢
- æ ‡ç­¾ä½¿ç”¨ç»Ÿè®¡

### ğŸ‘¥ ç”¨æˆ·è®¤è¯
- ç”¨æˆ·æ³¨å†Œä¸ç™»å½•ï¼ˆJWT è®¤è¯ï¼‰
- ç®¡ç†å‘˜å®¡æ‰¹æ–°ç”¨æˆ·
- è§’è‰²æƒé™æ§åˆ¶ï¼ˆadmin/userï¼‰
- **ç”¨æˆ·ç®¡ç†ç•Œé¢**ï¼šç®¡ç†å‘˜å¯åˆ›å»º/ç¦ç”¨/åˆ é™¤ç”¨æˆ·ã€ä¿®æ”¹å¯†ç 
- **ä¸ªäººä¸­å¿ƒ**ï¼šä¿®æ”¹å¯†ç ã€ç”Ÿæˆä¸ªäºº API å¯†é’¥
- é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š`admin` / `admin123`

**æƒé™çŸ©é˜µï¼š**

| åŠŸèƒ½é¡µé¢ | æ¸¸å®¢ | ç™»å½•ç”¨æˆ· | ç®¡ç†å‘˜ |
|---------|:----:|:-------:|:-----:|
| ä»ªè¡¨ç›˜ | âœ… | âœ… | âœ… |
| å›¾ç‰‡æ¢ç´¢ï¼ˆå›¾åº“æµè§ˆ + æ™ºèƒ½æœç´¢ï¼‰ | âœ… | âœ… | âœ… |
| æˆ‘çš„å›¾åº“ï¼ˆç¼–è¾‘/åˆ é™¤/æ‰¹é‡æ“ä½œï¼‰ | âŒ | âœ… | âœ… |
| ä¸Šä¼ å›¾ç‰‡ | âŒ | âœ… | âœ… |
| ä»»åŠ¡é˜Ÿåˆ— | âŒ | âœ… | âœ… |
| æ”¶è—å¤¹ | âŒ | âœ… | âœ… |
| ä¸ªäººä¸­å¿ƒï¼ˆä¿®æ”¹å¯†ç /API Keyï¼‰ | âŒ | âœ… | âœ… |
| æ ‡ç­¾ç®¡ç† | âŒ | âŒ | âœ… |
| å®¡æ‰¹ç®¡ç† | âŒ | âŒ | âœ… |
| å­˜å‚¨ç®¡ç†ï¼ˆS3 åŒæ­¥ï¼‰ | âŒ | âŒ | âœ… |
| ç³»ç»Ÿè®¾ç½® | âŒ | âŒ | âœ… |

### âš¡ æ‰¹é‡æ“ä½œ
- æ‰¹é‡å›¾ç‰‡é€‰æ‹©
- æ‰¹é‡åˆ é™¤ã€æ‰¹é‡æ‰“æ ‡ç­¾
- æ‰¹é‡åŠ å…¥æ”¶è—å¤¹
- æ‰¹é‡ AI åˆ†æï¼ˆå¼‚æ­¥é˜Ÿåˆ—ï¼‰
- **æ‰¹é‡ API**ï¼šå•æ¬¡è¯·æ±‚å¤„ç†å¤šå›¾ç‰‡

### ğŸ“¦ å…¶ä»–åŠŸèƒ½
- æ‰¹é‡ä¸Šä¼ ä¸ ZIP å‹ç¼©åŒ…å¯¼å…¥
- æœ¬åœ°åµŒå…¥æ¨¡å‹ï¼ˆæ— éœ€ APIï¼‰
- ç°ä»£åŒ–æ¯›ç»ç’ƒ UI è®¾è®¡
- æ·±è‰²æ¨¡å¼æ”¯æŒ
- **å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤æœªå®Œæˆä»»åŠ¡**
- **æ•°æ®å¤‡ä»½ä¸æ¢å¤**ï¼šå¯¼å‡º/å¯¼å…¥æ•°æ®åº“è®°å½•ï¼ˆJSON æ ¼å¼ï¼‰
- **é‡å¤å›¾ç‰‡æ£€æµ‹**ï¼šåŸºäºæ–‡ä»¶ MD5 å“ˆå¸Œæ£€æµ‹å¹¶ç­›é€‰é‡å¤å›¾ç‰‡
- **åŠ¨æ€æ¨¡å‹é€‰æ‹©**ï¼šä» API å®æ—¶è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
ImgTag/
â”œâ”€â”€ src/imgtag/              # Python åç«¯
â”‚   â”œâ”€â”€ api/                 # API ç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ endpoints/       # è·¯ç”±å¤„ç†å™¨
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ db/                  # æ•°æ®åº“
â”‚   â”‚   â””â”€â”€ repositories/    # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ schemas/             # Pydantic æ¨¡å‹
â”‚   â””â”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ web/                     # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/             # API è°ƒç”¨ (TanStack Query)
â”‚   â”‚   â”œâ”€â”€ components/      # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/          # Shadcn-Vue åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ layout/      # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/          # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/           # TypeScript ç±»å‹
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”œâ”€â”€ uploads/                 # å›¾ç‰‡å­˜å‚¨ç›®å½•
â”œâ”€â”€ Dockerfile               # Docker é•œåƒ
â”œâ”€â”€ docker-compose.yml       # Docker Compose
â””â”€â”€ pyproject.toml           # Python é¡¹ç›®é…ç½®
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

```
images              # å›¾ç‰‡è¡¨
â”œâ”€â”€ id, image_url, file_path, s3_path
â”œâ”€â”€ description, embedding (vector)
â”œâ”€â”€ file_hash, file_size, original_url
â””â”€â”€ uploaded_by, analyzed_at, created_at

tags                # æ ‡ç­¾è¡¨
â”œâ”€â”€ id, name, level (0=åˆ†ç±», 1=åˆ†è¾¨ç‡, 2=æ™®é€šæ ‡ç­¾)
â””â”€â”€ usage_count, parent_id

image_tags          # å›¾ç‰‡-æ ‡ç­¾å…³è”è¡¨
â”œâ”€â”€ image_id, tag_id
â”œâ”€â”€ source (ai/user)
â””â”€â”€ added_by, added_at

users               # ç”¨æˆ·è¡¨
â”œâ”€â”€ id, username, password_hash
â”œâ”€â”€ role (admin/user), status (pending/approved)
â””â”€â”€ api_key, created_at

collections         # æ”¶è—å¤¹è¡¨
â”œâ”€â”€ id, name, user_id, parent_id
â””â”€â”€ auto_tags

tasks               # ä»»åŠ¡è¡¨
â”œâ”€â”€ id, task_type, status
â””â”€â”€ payload, result, error

configs             # é…ç½®è¡¨
â””â”€â”€ key, value
```

**å…³é”®è®¾è®¡ï¼š**
- æ ‡ç­¾ä½¿ç”¨å…³è”è¡¨ `image_tags` å­˜å‚¨ï¼Œæ”¯æŒè¿½è¸ªæ¥æºå’Œæ“ä½œäºº
- `tags.level` åŒºåˆ†æ ‡ç­¾ç±»å‹ï¼šä¸»åˆ†ç±»(0)ã€åˆ†è¾¨ç‡(1)ã€æ™®é€šæ ‡ç­¾(2)
- ç”¨æˆ·æ³¨å†Œéœ€ç®¡ç†å‘˜å®¡æ‰¹ï¼ˆ`users.status`ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/127Wzc/ImgTag.git
cd ImgTag

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# è®¿é—®ï¼šhttp://localhost:8000ï¼ˆå•ç«¯å£åŒæ—¶æä¾› API å’Œå‰ç«¯ï¼‰
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘

#### ç¯å¢ƒè¦æ±‚
- Python 3.10+
- Node.js 18+
- PostgreSQL 15+ (éœ€å¯ç”¨ pgvector æ‰©å±•)

#### 1. é…ç½®æ•°æ®åº“

```sql
CREATE DATABASE imgtag;
\c imgtag
CREATE EXTENSION vector;
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥æ•°æ®åº“è¿æ¥
```

```env
PG_CONNECTION_STRING=postgresql://user:password@localhost:5432/imgtag
```

#### 3. å¯åŠ¨åç«¯

```bash
# å®‰è£…ä¾èµ–
uv sync

# ä½¿ç”¨æœ¬åœ°åµŒå…¥æ¨¡å‹ï¼ˆå¯é€‰ï¼Œçº¦ 90MBï¼‰
uv sync --extra local

# å¯åŠ¨æœåŠ¡
uv run python -m uvicorn imgtag.main:app --reload --host 0.0.0.0
```

#### 4. å¯åŠ¨å‰ç«¯

```bash
cd web
pnpm install
pnpm dev
```

è®¿é—® http://localhost:5173

---

## ğŸ“‹ é…ç½®è¯´æ˜

é€šè¿‡ Web ç•Œé¢ã€Œç³»ç»Ÿè®¾ç½®ã€é¡µé¢ç®¡ç†æ‰€æœ‰é…ç½®ï¼š

### è§†è§‰æ¨¡å‹

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|
| API åœ°å€ | OpenAI å…¼å®¹ç«¯ç‚¹ | `https://api.openai.com/v1` |
| API å¯†é’¥ | æ¨¡å‹ API Key | `sk-xxx` |
| æ¨¡å‹åç§° | è§†è§‰æ¨¡å‹ ID | `gpt-4o-mini` |

### åµŒå…¥æ¨¡å‹

**æœ¬åœ°æ¨¡å‹**ï¼ˆæ¨èï¼‰ï¼š
- æ— éœ€ APIï¼Œå®Œå…¨ç¦»çº¿
- æ”¯æŒ `BAAI/bge-small-zh-v1.5`ï¼ˆçº¦ 90MBï¼Œ512 ç»´ï¼‰

**åœ¨çº¿ API**ï¼š
- ä½¿ç”¨ OpenAI `text-embedding-3-small` ç­‰ API

---

## ğŸ”§ å†…éƒ¨ API

å†…éƒ¨ API ä½¿ç”¨ JWT è®¤è¯ï¼ˆWeb ç•Œé¢è‡ªåŠ¨å¤„ç†ï¼‰ï¼Œä¾›å‰ç«¯é¡µé¢è°ƒç”¨ã€‚

### ä¸»è¦ç«¯ç‚¹

| æ¨¡å— | è·¯å¾„å‰ç¼€ | è¯´æ˜ |
|------|---------|------|
| å›¾ç‰‡ç®¡ç† | `/api/v1/images` | ä¸Šä¼ ã€CRUDã€æ‰¹é‡æ“ä½œ |
| æœç´¢ | `/api/v1/search` | è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢ |
| æ”¶è—å¤¹ | `/api/v1/collections` | æ”¶è—å¤¹ç®¡ç† |
| æ ‡ç­¾ | `/api/v1/tags` | æ ‡ç­¾åˆ—è¡¨ã€ç®¡ç† |
| ä»»åŠ¡é˜Ÿåˆ— | `/api/v1/queue` | åˆ†æä»»åŠ¡ç®¡ç† |
| è®¤è¯ | `/api/v1/auth` | ç™»å½•ã€æ³¨å†Œã€ç”¨æˆ·ç®¡ç† |
| ç³»ç»Ÿ | `/api/v1/system` | å¤‡ä»½ã€å¯¼å…¥ã€é‡å¤æ£€æµ‹ |

ğŸ“– **å®Œæ•´æ–‡æ¡£**ï¼šhttp://localhost:8000/docs

---

## ğŸ”Œ å¤–éƒ¨ API

ä¾›ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ¥å…¥çš„ APIï¼Œä½¿ç”¨ä¸ªäºº API å¯†é’¥è®¤è¯ã€‚

### å¿«é€Ÿå¼€å§‹

1. åœ¨ **ä¸ªäººä¸­å¿ƒ**ï¼ˆç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·åï¼‰ç”Ÿæˆ API å¯†é’¥
2. è°ƒç”¨ API æ—¶æºå¸¦å¯†é’¥ï¼ˆHeader æˆ–å‚æ•°æ–¹å¼ï¼‰

### æ¥å£åˆ—è¡¨

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `GET /api/v1/random` | è·å–éšæœºå›¾ç‰‡ |
| `POST /api/v1/add-image` | é€šè¿‡ URL æ·»åŠ å›¾ç‰‡ |
| `GET /api/v1/image/{id}` | è·å–å›¾ç‰‡è¯¦æƒ… |
| `GET /api/v1/search` | æœç´¢å›¾ç‰‡ |

### ç¤ºä¾‹

```bash
# è·å–éšæœºå›¾ç‰‡
curl "http://localhost:8000/api/v1/random?api_key=YOUR_KEY&count=1"

# æ·»åŠ å›¾ç‰‡
curl -X POST "http://localhost:8000/api/v1/add-image?api_key=YOUR_KEY" \
  -H "Content-Type: application/json" \
  -d '{"image_url": "https://example.com/image.jpg"}'

# æœç´¢å›¾ç‰‡ï¼ˆå…³é”®è¯éœ€ URL ç¼–ç ï¼‰
curl "http://localhost:8000/api/v1/search?api_key=YOUR_KEY&keyword=%E5%88%9D%E9%9F%B3&limit=10"
```

ğŸ“– **å®Œæ•´æ–‡æ¡£**ï¼š[docs/EXTERNAL_API.md](docs/EXTERNAL_API.md)

---

## ğŸ“¦ æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- FastAPI - Web æ¡†æ¶
- PostgreSQL + pgvector - å‘é‡æ•°æ®åº“
- Sentence Transformers - æœ¬åœ°åµŒå…¥

**å‰ç«¯**ï¼š
- Vue 3 + Composition API + TypeScript
- Shadcn-Vue + Radix Vue - UI ç»„ä»¶
- Tailwind CSS 4 - æ ·å¼ç³»ç»Ÿ
- TanStack Query - æ•°æ®è·å–
- Pinia - çŠ¶æ€ç®¡ç†
- Vite - æ„å»ºå·¥å…·

---

## ğŸ³ Docker éƒ¨ç½²

### å‰ææ¡ä»¶
éœ€è¦å·²æœ‰ PostgreSQL æ•°æ®åº“ï¼ˆå¯ç”¨ pgvector æ‰©å±•ï¼‰

### ä½¿ç”¨ Docker Compose

1. é…ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥æ•°æ®åº“è¿æ¥
```

2. å¯åŠ¨æœåŠ¡ï¼š
```bash
docker-compose up -d
```

3. è®¿é—®ï¼šhttp://localhost:8000

### å•ç‹¬æ„å»ºè¿è¡Œ

```bash
# æ„å»ºé•œåƒ
docker build -t imgtag .

# è¿è¡Œï¼ˆå•ç«¯å£åŒæ—¶æä¾› API å’Œå‰ç«¯ï¼‰
docker run -d \
  -p 8000:8000 \
  -e PG_CONNECTION_STRING=postgresql://user:pass@host:5432/imgtag \
  -v ./uploads:/app/uploads \
  imgtag
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|-----|------|-------|
| `PG_CONNECTION_STRING` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | å¿…å¡« |
| `BASE_URL` | æœåŠ¡åœ°å€ | `http://localhost:8000` |
| `UPLOAD_DIR` | å›¾ç‰‡ä¸Šä¼ ç›®å½• | `./uploads` |

---

## ğŸ“„ License

MIT